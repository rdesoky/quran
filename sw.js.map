{"version":3,"file":"sw.mjs","sources":["../public/sw.js"],"sourcesContent":["/* eslint-disable no-restricted-globals */\r\n\r\nconst appVersion = 28;\r\nconst appCacheId = `app.v${appVersion}`;\r\nconst assetsVersion = 1;\r\nconst assetsCacheId = `assets.v${assetsVersion}`;\r\n\r\nconst assetRoots = [location.origin /*, \"https://www.everyayah.com/data\"*/];\r\nconst cacheExcludes = [\"browser-sync\"]; //\r\n\r\nconst deleteOldCaches = async () => {\r\n\tconst cacheNames = await caches.keys();\r\n\tconst oldCacheNames = cacheNames.filter(\r\n\t\t(name) => name !== appCacheId && name !== assetsCacheId\r\n\t);\r\n\tawait Promise.all(oldCacheNames.map((name) => caches.delete(name)));\r\n};\r\n\r\nconst addResourcesToCache = async () => {\r\n\tconst appManifest = await fetch(\"app-manifest.json\").then((res) =>\r\n\t\tres.json()\r\n\t);\r\n\tconst appFiles = Object.values(appManifest.files).filter(\r\n\t\t(file) => !file.includes(\".map\")\r\n\t);\r\n\tconst appCache = await caches.open(appCacheId);\r\n\tawait appCache.addAll(appFiles);\r\n\r\n\tconst publicManifest = await fetch(\"public-manifest.json\").then((res) =>\r\n\t\tres.json()\r\n\t);\r\n\tconst publicAssetsFiles = publicManifest.files.filter(\r\n\t\t(name) => !name.includes(\"sw.js\")\r\n\t);\r\n\tconst assetCache = await caches.open(assetsCacheId);\r\n\tawait assetCache.addAll(publicAssetsFiles);\r\n};\r\n\r\nconst putInCache = async (request, response) => {\r\n\tif (\r\n\t\trequest.method !== \"GET\" ||\r\n\t\tresponse.status !== 200 ||\r\n\t\t!assetRoots.some((cacheBase) => request.url.startsWith(cacheBase))\r\n\t) {\r\n\t\treturn;\r\n\t}\r\n\tif (cacheExcludes.some((exclude) => request.url.includes(exclude))) {\r\n\t\treturn;\r\n\t}\r\n\tconst assetCache = await caches.open(assetsCacheId);\r\n\tawait assetCache.put(request, response);\r\n};\r\n\r\nconst cacheFirst = async ({ request, preloadResponsePromise, fallbackUrl }) => {\r\n\t// First try to get the resource from the cache\r\n\tconst responseFromCache = await caches.match(request);\r\n\tif (responseFromCache && responseFromCache.status === 200) {\r\n\t\treturn responseFromCache;\r\n\t}\r\n\r\n\t// Next try to use the preloaded response, if it's there\r\n\tif (preloadResponsePromise) {\r\n\t\tconst preloadResponse = await preloadResponsePromise;\r\n\t\tif (preloadResponse) {\r\n\t\t\tconsole.info(\"using preload response\", preloadResponse);\r\n\t\t\tputInCache(request, preloadResponse.clone());\r\n\t\t\treturn preloadResponse;\r\n\t\t}\r\n\t}\r\n\r\n\t// Next try to get the resource from the network\r\n\ttry {\r\n\t\tconst responseFromNetwork = await fetch(request);\r\n\t\t// response may be used only once\r\n\t\t// we need to save clone to put one copy in cache\r\n\t\t// and serve second one\r\n\t\tputInCache(request, responseFromNetwork.clone());\r\n\t\treturn responseFromNetwork;\r\n\t} catch (error) {\r\n\t\tconst fallbackResponse = await caches.match(fallbackUrl);\r\n\t\tif (fallbackResponse) {\r\n\t\t\treturn fallbackResponse;\r\n\t\t}\r\n\t\t// when even the fallback response is not available,\r\n\t\t// there is nothing we can do, but we must always\r\n\t\t// return a Response object\r\n\t\treturn new Response(\"Network error happened\", {\r\n\t\t\tstatus: 408,\r\n\t\t\theaders: { \"Content-Type\": \"text/plain\" },\r\n\t\t});\r\n\t}\r\n};\r\n\r\nconst enableNavigationPreload = async () => {\r\n\tif (self.registration.navigationPreload) {\r\n\t\t// Enable navigation preloads!\r\n\t\tawait self.registration.navigationPreload.enable();\r\n\t}\r\n};\r\n\r\nself.addEventListener(\"activate\", (event) => {\r\n\tevent.waitUntil(\r\n\t\tPromise.all([enableNavigationPreload(), deleteOldCaches()])\r\n\t);\r\n});\r\n\r\nself.addEventListener(\"install\", (event) => {\r\n\tconst cacheResources = addResourcesToCache();\r\n\tevent.waitUntil(cacheResources);\r\n\tcacheResources.then(() => {\r\n\t\tself.skipWaiting();\r\n\t});\r\n});\r\n\r\nself.addEventListener(\"fetch\", (event) => {\r\n\tconst request =\r\n\t\tevent.request.mode === \"navigate\"\r\n\t\t\t? new Request(location.origin + \"/index.html\")\r\n\t\t\t: event.request;\r\n\r\n\tevent.respondWith(\r\n\t\tcacheFirst({\r\n\t\t\trequest: request,\r\n\t\t\tpreloadResponsePromise: event.preloadResponse,\r\n\t\t\t// fallbackUrl: \"/images/offline.png\",\r\n\t\t})\r\n\t);\r\n});\r\n"],"names":["appCacheId","assetsCacheId","assetRoots","cacheExcludes","deleteOldCaches","oldCacheNames","name","addResourcesToCache","appManifest","res","appFiles","file","publicAssetsFiles","putInCache","request","response","cacheBase","exclude","cacheFirst","preloadResponsePromise","fallbackUrl","responseFromCache","preloadResponse","responseFromNetwork","fallbackResponse","enableNavigationPreload","event","cacheResources"],"mappings":"AAGA,MAAMA,EAAa,UAEnB,MAAMC,EAAgB,YAEhBC,EAAa,CAAC,SAAS,QACvBC,EAAgB,CAAC,cAAc,EAE/BC,EAAkB,SAAY,CAEnC,MAAMC,GADa,MAAM,OAAO,QACC,OAC/BC,GAASA,IAASN,GAAcM,IAASL,CAC5C,EACC,MAAM,QAAQ,IAAII,EAAc,IAAKC,GAAS,OAAO,OAAOA,CAAI,CAAC,CAAC,CACnE,EAEMC,EAAsB,SAAY,CACvC,MAAMC,EAAc,MAAM,MAAM,mBAAmB,EAAE,KAAMC,GAC1DA,EAAI,KAAM,CACZ,EACOC,EAAW,OAAO,OAAOF,EAAY,KAAK,EAAE,OAChDG,GAAS,CAACA,EAAK,SAAS,MAAM,CACjC,EAEC,MADiB,MAAM,OAAO,KAAKX,CAAU,GAC9B,OAAOU,CAAQ,EAK9B,MAAME,GAHiB,MAAM,MAAM,sBAAsB,EAAE,KAAMH,GAChEA,EAAI,KAAM,CACZ,GAC0C,MAAM,OAC7CH,GAAS,CAACA,EAAK,SAAS,OAAO,CAClC,EAEC,MADmB,MAAM,OAAO,KAAKL,CAAa,GACjC,OAAOW,CAAiB,CAC1C,EAEMC,EAAa,MAAOC,EAASC,IAAa,CAQ/C,GANCD,EAAQ,SAAW,OACnBC,EAAS,SAAW,KACpB,CAACb,EAAW,KAAMc,GAAcF,EAAQ,IAAI,WAAWE,CAAS,CAAC,GAI9Db,EAAc,KAAMc,GAAYH,EAAQ,IAAI,SAASG,CAAO,CAAC,EAChE,OAGD,MADmB,MAAM,OAAO,KAAKhB,CAAa,GACjC,IAAIa,EAASC,CAAQ,CACvC,EAEMG,EAAa,MAAO,CAAE,QAAAJ,EAAS,uBAAAK,EAAwB,YAAAC,CAAW,IAAO,CAE9E,MAAMC,EAAoB,MAAM,OAAO,MAAMP,CAAO,EACpD,GAAIO,GAAqBA,EAAkB,SAAW,IACrD,OAAOA,EAIR,GAAIF,EAAwB,CAC3B,MAAMG,EAAkB,MAAMH,EAC9B,GAAIG,EACH,eAAQ,KAAK,yBAA0BA,CAAe,EACtDT,EAAWC,EAASQ,EAAgB,MAAO,CAAA,EACpCA,CAER,CAGD,GAAI,CACH,MAAMC,EAAsB,MAAM,MAAMT,CAAO,EAI/C,OAAAD,EAAWC,EAASS,EAAoB,MAAO,CAAA,EACxCA,CACP,MAAe,CACf,MAAMC,EAAmB,MAAM,OAAO,MAAMJ,CAAW,EACvD,OAAII,GAMG,IAAI,SAAS,yBAA0B,CAC7C,OAAQ,IACR,QAAS,CAAE,eAAgB,YAAc,CAC5C,CAAG,CACD,CACF,EAEMC,EAA0B,SAAY,CACvC,KAAK,aAAa,mBAErB,MAAM,KAAK,aAAa,kBAAkB,OAAM,CAElD,EAEA,KAAK,iBAAiB,WAAaC,GAAU,CAC5CA,EAAM,UACL,QAAQ,IAAI,CAACD,EAAuB,EAAIrB,EAAiB,CAAA,CAAC,CAC5D,CACA,CAAC,EAED,KAAK,iBAAiB,UAAYsB,GAAU,CAC3C,MAAMC,EAAiBpB,IACvBmB,EAAM,UAAUC,CAAc,EAC9BA,EAAe,KAAK,IAAM,CACzB,KAAK,YAAW,CAClB,CAAE,CACF,CAAC,EAED,KAAK,iBAAiB,QAAUD,GAAU,CACzC,MAAMZ,EACLY,EAAM,QAAQ,OAAS,WACpB,IAAI,QAAQ,SAAS,OAAS,aAAa,EAC3CA,EAAM,QAEVA,EAAM,YACLR,EAAW,CACV,QAASJ,EACT,uBAAwBY,EAAM,eAEjC,CAAG,CACH,CACA,CAAC"}